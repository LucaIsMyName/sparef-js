{"mappings":"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","sources":["src/sparef.ts","src/prefetch.ts","src/transition.ts","src/utils.ts"],"sourcesContent":["// src/sparef.ts\n\nimport { setupPrefetch } from \"./prefetch\";\nimport { setupTransition } from \"./transition\";\nimport { applyDefaults } from \"./utils\";\nimport { SparefOptions, PrefetchOptions, TransitionOptions } from \"./types\";\n\nconst defaultOptions: SparefOptions = {\n  prefetch: {\n    active: false,\n    event: \"mouseover\",\n    delay: 0,\n    sameOrigin: true,\n  },\n  transition: {\n    duration: 250,\n    delay: 0,\n    timeline: \"parallel\",\n    easing: \"ease-in-out\",\n    iterations: 1,\n    out: {\n      from: { opacity: 1 },\n      to: { opacity: 0 },\n    },\n    in: {\n      from: { opacity: 0 },\n      to: { opacity: 1 },\n    },\n  },\n};\n\n/**\n * \n * @description Set up SPA transitions and prefetching.\n */\nexport function sparef(selector: string | string[], options: Partial<SparefOptions> = {}): void {\n  const mergedOptions = applyDefaults(options, defaultOptions);\n  console.log(\"Merged options:\", mergedOptions); // Add this line\n\n  const selectors = Array.isArray(selector) ? selector : [selector];\n\n  selectors.forEach((sel) => {\n    const container = document.querySelector(sel);\n    if (!container) {\n      console.error(`No element found with selector: ${sel}`);\n      return;\n    }\n\n    console.log(\"Setting up prefetch with options:\", mergedOptions.prefetch); // Add this line\n    setupPrefetch(container, mergedOptions.prefetch);\n    setupTransition(container, mergedOptions.transition);\n  });\n}\n\nexport default sparef;","import { PrefetchOptions } from './types';\n\nconst prefetchedLinks = new Set<string>();\n\nfunction isSameOrigin(href: string): boolean {\n  try {\n    const url = new URL(href, window.location.origin);\n    return url.origin === window.location.origin;\n  } catch {\n    return false;\n  }\n}\n\nexport function setupPrefetch(container: Element, options: PrefetchOptions): void {\n  console.log(\"Setting up prefetch with options:\", options);\n  if (!options.active) return;\n\n  const links = container.querySelectorAll('a[href^=\"/\"], a[href^=\"./\"], a[href^=\"../\"], a[href^=\"http://\"], a[href^=\"https://\"]');\n\n  links.forEach(link => {\n    link.addEventListener(options.event, () => {\n      setTimeout(() => {\n        const href = link.getAttribute('href');\n        if (href && !prefetchedLinks.has(href) && (options.sameOrigin === false || isSameOrigin(href))) {\n          const prefetchLink = document.createElement('link');\n          prefetchLink.rel = 'prefetch';\n          prefetchLink.href = href;\n          document.head.appendChild(prefetchLink);\n          prefetchedLinks.add(href);\n          console.log('Prefetched: ', href);\n        }\n      }, options.delay);\n    });\n  });\n}","// src/transition.ts\n\nimport { TransitionOptions, TransitionAnimation, TransitionStyles } from \"./types\";\nimport { kebabCase } from \"./utils\";\n\n/**\n * @description Set up\n * transition between pages.\n */\ndeclare global {\n  interface Document {\n    startViewTransition?: (callback: () => void) => {\n      finished: Promise<void>;\n      updateCallbackDone: Promise<void>;\n      ready: Promise<void>;\n    };\n  }\n}\n\nlet styleCounter = 0;\nclass MockAnimation implements Animation {\n  currentTime: number | null = 0;\n  effect: AnimationEffect | null = null;\n  id: string = \"\";\n  oncancel: ((this: Animation, ev: AnimationPlaybackEvent) => any) | null = null;\n  onfinish: ((this: Animation, ev: AnimationPlaybackEvent) => any) | null = null;\n  onremove: ((this: Animation, ev: Event) => any) | null = null;\n  pending: boolean = false;\n  playState: AnimationPlayState = \"idle\";\n  playbackRate: number = 1;\n  replaceState: AnimationReplaceState = \"active\";\n  startTime: number | null = 0;\n  timeline: AnimationTimeline | null = null;\n\n  // Implement finished and ready as getters\n  get finished(): Promise<Animation> {\n    return Promise.resolve(this);\n  }\n\n  get ready(): Promise<Animation> {\n    return Promise.resolve(this);\n  }\n\n  cancel(): void {}\n  commitStyles(): void {}\n  finish(): void {}\n  pause(): void {}\n  persist(): void {}\n  play(): void {}\n  reverse(): void {}\n  updatePlaybackRate(_playbackRate: number): void {}\n  addEventListener(_type: string, _listener: EventListenerOrEventListenerObject, _options?: boolean | AddEventListenerOptions): void {}\n  removeEventListener(_type: string, _listener: EventListenerOrEventListenerObject, _options?: boolean | EventListenerOptions): void {}\n  dispatchEvent(_event: Event): boolean {\n    return false;\n  }\n}\n/**\n * @description Set up\n * transition between pages.\n */\nexport function setupTransition(\n  container: Element,\n  options: TransitionOptions,\n  animateFunction: (element: Element, keyframes: Keyframe[], options: KeyframeAnimationOptions) => Animation = (element, keyframes, options) => {\n    if (typeof element.animate === \"function\") {\n      return element.animate(keyframes, options);\n    } else {\n      // Fallback for environments where animate is not available (like jsdom)\n      return new MockAnimation();\n    }\n  }\n): void {\n  console.log(\"Setting up transition with options:\", options);\n\n  const links = container.querySelectorAll('a[href^=\"/\"], a[href^=\"./\"], a[href^=\"../\"]');\n\n  links.forEach((link) => {\n    link.addEventListener(\"click\", (e) => {\n      e.preventDefault();\n      const href = link.getAttribute(\"href\");\n\n      if (href) {\n        navigateTo(href, container, options, animateFunction);\n      }\n    });\n  });\n\n  // Add popstate event listener for browser back/forward buttons\n  window.addEventListener(\"popstate\", (event) => {\n    if (event.state && event.state.href) {\n      navigateTo(event.state.href, container, options, animateFunction, false);\n    }\n  });\n}\n\nasync function navigateTo(href: string, container: Element, options: TransitionOptions, animateFunction: (element: Element, keyframes: Keyframe[], options: KeyframeAnimationOptions) => Animation, pushState: boolean = true): Promise<void> {\n  if (document.startViewTransition) {\n    await performViewTransition(href, container, options, animateFunction);\n  } else {\n    await performFallbackTransition(href, container, options, animateFunction);\n  }\n\n  if (pushState) {\n    history.pushState({ href }, \"\", href);\n  }\n}\n\n/**\n * @description Generate a CSS style\n * string from a  transition animation object.\n */\nexport function generateStyleString(animation: TransitionAnimation): { from: string; to: string } {\n  function styleObjectToString(obj: Record<string, any>): string {\n    return Object.entries(obj)\n      .map(([key, value]) => {\n        if (typeof value === \"object\") {\n          return `${kebabCase(key)}: ${styleObjectToString(value)};`;\n        }\n        return `${kebabCase(key)}: ${value};`;\n      })\n      .join(\" \");\n  }\n\n  return {\n    from: styleObjectToString(animation.from),\n    to: styleObjectToString(animation.to),\n  };\n}\n\n/**\n *\n * @description Add CSS styles\n * for a view transition animation.\n */\nfunction addViewTransitionCSS(container: Element, options: TransitionOptions): string {\n  const outStyles = generateStyleString(options.out);\n  const inStyles = generateStyleString(options.in);\n  const styleId = `sparef-style-${styleCounter++}`;\n\n  const css = `\n    ::view-transition-old(${container.tagName.toLowerCase()}),\n    ::view-transition-new(${container.tagName.toLowerCase()}) {\n      animation-duration: ${options.duration}ms;\n      animation-timing-function: ${options.easing};\n      animation-iteration-count: ${options.iterations};\n    }\n\n    ::view-transition-old(${container.tagName.toLowerCase()}) {\n      animation-name: sparef_fade-out-${styleId};\n    }\n\n    ::view-transition-new(${container.tagName.toLowerCase()}) {\n      animation-name: sparef_fade-in-${styleId};\n    }\n\n    @keyframes sparef_fade-out-${styleId} {\n      from { ${outStyles.from} }\n      to { ${outStyles.to} }\n    }\n\n    @keyframes sparef_fade-in-${styleId} {\n      from { ${inStyles.from} }\n      to { ${inStyles.to} }\n    }\n  `;\n\n  const style = document.createElement(\"style\");\n  style.id = styleId;\n  style.textContent = css;\n  document.head.appendChild(style);\n\n  return styleId;\n}\n\n/**\n *\n * @description Remove a style\n * tag from the DOM.\n */\nfunction removeStyle(styleId: string): void {\n  const style = document.getElementById(styleId);\n  if (style) {\n    style.remove();\n  }\n}\n\n/**\n *\n * @description Perform a custom\n * view transition animation.\n */\nasync function performViewTransition(href: string, container: Element, options: TransitionOptions, animateFunction: (element: Element, keyframes: Keyframe[], options: KeyframeAnimationOptions) => Animation): Promise<void> {\n  try {\n    const styleId = addViewTransitionCSS(container, options);\n    const transition = document.startViewTransition!(() => updateDOM(href, container, options, animateFunction));\n\n    await transition.finished;\n    removeStyle(styleId);\n    console.log(\"Custom Transition complete\", options);\n  } catch (error) {\n    console.error(\"View transition failed:\", error);\n    window.location.href = href;\n  }\n}\n\n/**\n *\n * @description Perform a fallback\n * transition animation.\n */\nasync function performFallbackTransition(href: string, container: Element, options: TransitionOptions, animateFunction: (element: Element, keyframes: Keyframe[], options: KeyframeAnimationOptions) => Animation): Promise<void> {\n  const styleId = addViewTransitionCSS(container, options);\n  try {\n    const duration = options.duration;\n    const outAnim = createKeyframeAnimation(options.out, `out-${styleId}`);\n    const inAnim = createKeyframeAnimation(options.in, `in-${styleId}`);\n    const animationOptions: KeyframeAnimationOptions = {\n      duration: options.timeline === \"sequential\" ? duration / 2 : duration,\n      easing: options.easing,\n      iterations: options.iterations === \"infinite\" ? Infinity : options.iterations,\n      fill: \"forwards\",\n    };\n    const outAnimation = animateFunction(container, outAnim.keyframes, animationOptions);\n\n    if (outAnimation.finished) {\n      await outAnimation.finished;\n    } else {\n      await new Promise((resolve) => setTimeout(resolve, animationOptions.duration as number));\n    }\n\n    await updateDOM(href, container, options, animateFunction);\n\n    const inAnimation = animateFunction(container, inAnim.keyframes, {\n      duration: options.timeline === \"sequential\" ? duration / 2 : duration,\n      easing: options.easing,\n      iterations: 1,\n      fill: \"forwards\",\n    });\n\n    if (inAnimation.finished) {\n      await inAnimation.finished;\n    } else {\n      await new Promise((resolve) => setTimeout(resolve, duration / 2));\n    }\n  } finally {\n    removeStyle(styleId);\n    console.log(\"Fallback Transition complete\");\n  }\n}\n\n/**\n * @description Update the DOM\n * with new content.\n */\nasync function updateDOM(href: string, container: Element, options: TransitionOptions, animateFunction: (element: Element, keyframes: Keyframe[], options: KeyframeAnimationOptions) => Animation): Promise<void> {\n  try {\n    const response = await fetch(href);\n    const html = await response.text();\n    const newDocument = new DOMParser().parseFromString(html, \"text/html\");\n\n    // Update the page title\n    document.title = newDocument.title;\n\n    // Update the specific container content\n    const newContent = newDocument.querySelector(container.tagName);\n    if (newContent) {\n      container.innerHTML = newContent.innerHTML;\n    }\n\n    // Re-attach event listeners to the new content\n    setupTransition(container, options, animateFunction);\n  } catch (error) {\n    console.error(\"Failed to update DOM:\", error);\n    window.location.href = href;\n  }\n}\n\n/**\n *\n * @description Create a keyframe animation\n * object from a transition animation object.\n */\nfunction createKeyframeAnimation(animOptions: TransitionAnimation, prefix: string): { keyframes: Keyframe[] } {\n  return {\n    keyframes: [\n      { [prefix]: \"0%\", ...animOptions.from },\n      { [prefix]: \"100%\", ...animOptions.to },\n    ],\n  };\n}\n","// src/utils.ts\n\n/**\n * @description This function takes two objects, \n * options and defaults, and returns a new object \n * with the default values applied to the options object. \n * If a key exists in both objects, the value from \n * the options object is used. If the value is an object, \n * the function is called recursively to apply the defaults \n * to the nested object.\n */\nexport function applyDefaults<T extends Record<string, any>>(options: Partial<T>, defaults: T): T {\n  const result = { ...defaults };\n  for (const key in options) {\n    if (Object.prototype.hasOwnProperty.call(options, key)) {\n      const value = options[key];\n      if (typeof value === 'object' && value !== null && key in result) {\n        result[key] = applyDefaults(\n          value as Partial<T[Extract<keyof T, string>]>,\n          result[key] as T[Extract<keyof T, string>]\n        );\n      } else {\n        result[key] = value as T[Extract<keyof T, string>];\n      }\n    }\n  }\n  return result;\n}\n\n/**\n * @description This function converts a string to \n * kebab case by replacing all uppercase letters with a \n * hyphen followed by the lowercase version of the letter.\n */\nexport function kebabCase(str: string): string {\n  return str.replace(/[A-Z]/g, letter => `-${letter.toLowerCase()}`);\n}"],"names":[],"version":3,"file":"sparef.js.map"}