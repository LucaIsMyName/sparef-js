{"mappings":"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","sources":["src/sparef.ts","src/prefetch.ts","src/transition.ts","src/utils.ts"],"sourcesContent":["// src/sparef.ts\n\nimport { setupPrefetch } from \"./prefetch\";\nimport { setupTransition } from \"./transition\";\nimport { applyDefaults } from \"./utils\";\nimport { SparefOptions, PrefetchOptions, TransitionOptions } from \"./types\";\n\nconst defaultOptions: SparefOptions = {\n  prefetch: {\n    active: false,\n    event: \"mouseover\",\n    delay: 0,\n  },\n  transition: {\n    duration: 300,\n    delay: 0,\n    timeline: \"sequential\",\n    easing: \"ease\",\n    iterations: 1,\n    out: {\n      from: { opacity: 1 },\n      to: { opacity: 0 },\n    },\n    in: {\n      from: { opacity: 0 },\n      to: { opacity: 1 },\n    },\n  },\n};\n\nexport function sparef(selector: string | string[], options: Partial<SparefOptions> = {}): void {\n  const mergedOptions = applyDefaults(options, defaultOptions);\n\n  const selectors = Array.isArray(selector) ? selector : [selector];\n\n  selectors.forEach((sel) => {\n    const container = document.querySelector(sel);\n    if (!container) {\n      console.error(`No element found with selector: ${sel}`);\n      return;\n    }\n\n    setupPrefetch(container, mergedOptions.prefetch);\n    setupTransition(container, mergedOptions.transition);\n  });\n}\n\nexport default sparef;","// src/prefetch.ts\n\nimport { PrefetchOptions } from './types';\n\nconst prefetchedLinks = new Set<string>();\n\nexport function setupPrefetch(container: Element, options: PrefetchOptions): void {\n  if (!options.active) return;\n\n  const links = container.querySelectorAll('a[href^=\"/\"], a[href^=\"./\"], a[href^=\"../\"]');\n\n  links.forEach(link => {\n    link.addEventListener(options.event, () => {\n      setTimeout(() => {\n        const href = link.getAttribute('href');\n        if (href && !prefetchedLinks.has(href)) {\n          const prefetchLink = document.createElement('link');\n          prefetchLink.rel = 'prefetch';\n          prefetchLink.href = href;\n          document.head.appendChild(prefetchLink);\n          prefetchedLinks.add(href);\n          console.log('Prefetched: ', href);\n        }\n      }, options.delay);\n    });\n  });\n}","// src/transition.ts\n\nimport { TransitionOptions, TransitionAnimation, TransitionStyles } from \"./types\";\nimport { kebabCase } from \"./utils\";\n\ndeclare global {\n  interface Document {\n    startViewTransition?: (callback: () => void) => {\n      finished: Promise<void>;\n      updateCallbackDone: Promise<void>;\n      ready: Promise<void>;\n    };\n  }\n}\n\nlet styleCounter = 0;\n\nexport function setupTransition(container: Element, options: TransitionOptions, animateFunction: (keyframes: Keyframe[], options: KeyframeAnimationOptions) => Animation = (el, opts) => container.animate(el, opts)): void {\n  const links = container.querySelectorAll('a[href^=\"/\"], a[href^=\"./\"], a[href^=\"../\"]');\n\n  links.forEach((link) => {\n    link.addEventListener(\"click\", (e) => {\n      e.preventDefault();\n      const href = link.getAttribute(\"href\");\n\n      if (href) {\n        if (document.startViewTransition) {\n          performViewTransition(href, container, options, animateFunction);\n        } else {\n          performFallbackTransition(href, container, options, animateFunction);\n        }\n      }\n    });\n  });\n}\n\nexport function generateStyleString(animation: TransitionAnimation): { from: string; to: string } {\n  const from = Object.entries(animation.from)\n    .map(([key, value]) => `${kebabCase(key)}: ${value};`)\n    .join(\" \");\n  const to = Object.entries(animation.to)\n    .map(([key, value]) => `${kebabCase(key)}: ${value};`)\n    .join(\" \");\n\n  return { from, to };\n}\n\nfunction addViewTransitionCSS(container: Element, options: TransitionOptions): string {\n  const outStyles = generateStyleString(options.out);\n  const inStyles = generateStyleString(options.in);\n  const styleId = `sparef-style-${styleCounter++}`;\n\n  const css = `\n    ::view-transition-old(${container.tagName.toLowerCase()}),\n    ::view-transition-new(${container.tagName.toLowerCase()}) {\n      animation-duration: ${options.duration}ms;\n      animation-timing-function: ${options.easing};\n      animation-iteration-count: ${options.iterations};\n    }\n\n    ::view-transition-old(${container.tagName.toLowerCase()}) {\n      animation-name: sparef_fade-out-${styleId};\n    }\n\n    ::view-transition-new(${container.tagName.toLowerCase()}) {\n      animation-name: sparef_fade-in-${styleId};\n    }\n\n    @keyframes sparef_fade-out-${styleId} {\n      from { ${outStyles.from} }\n      to { ${outStyles.to} }\n    }\n\n    @keyframes sparef_fade-in-${styleId} {\n      from { ${inStyles.from} }\n      to { ${inStyles.to} }\n    }\n  `;\n\n  const style = document.createElement(\"style\");\n  style.id = styleId;\n  style.textContent = css;\n  document.head.appendChild(style);\n\n  return styleId;\n}\n\nfunction removeStyle(styleId: string): void {\n  const style = document.getElementById(styleId);\n  if (style) {\n    style.remove();\n  }\n}\n\nasync function performViewTransition(href: string, container: Element, options: TransitionOptions, animateFunction: (keyframes: Keyframe[], options: KeyframeAnimationOptions) => Animation): Promise<void> {\n  try {\n    const styleId = addViewTransitionCSS(container, options);\n    const transition = document.startViewTransition!(() => updateDOM(href, container, options, animateFunction));\n\n    await transition.finished;\n    removeStyle(styleId);\n    console.log(\"Custom Transition complete\");\n  } catch (error) {\n    console.error(\"View transition failed:\", error);\n    window.location.href = href;\n  }\n}\n\nasync function performFallbackTransition(href: string, container: Element, options: TransitionOptions, animateFunction: (keyframes: Keyframe[], options: KeyframeAnimationOptions) => Animation): Promise<void> {\n  const styleId = addViewTransitionCSS(container, options);\n  const duration = options.duration;\n  const outAnim = createKeyframeAnimation(options.out, `out-${styleId}`);\n  const inAnim = createKeyframeAnimation(options.in, `in-${styleId}`);\n\n  const outAnimation = animateFunction(outAnim.keyframes, {\n    duration: options.timeline === \"sequential\" ? duration / 2 : duration,\n    easing: options.easing,\n    iterations: 1,\n    fill: \"forwards\",\n  });\n\n  await outAnimation.finished;\n\n  await updateDOM(href, container, options, animateFunction);\n\n  const inAnimation = animateFunction(inAnim.keyframes, {\n    duration: options.timeline === \"sequential\" ? duration / 2 : duration,\n    easing: options.easing,\n    iterations: 1,\n    fill: \"forwards\",\n  });\n\n  await inAnimation.finished;\n  removeStyle(styleId);\n  console.log(\"Fallback Transition complete\");\n}\n\nasync function updateDOM(href: string, container: Element, options: TransitionOptions, animateFunction: (keyframes: Keyframe[], options: KeyframeAnimationOptions) => Animation): Promise<void> {\n  try {\n    const response = await fetch(href);\n    const html = await response.text();\n    const newDocument = new DOMParser().parseFromString(html, \"text/html\");\n\n    // Update the page title\n    document.title = newDocument.title;\n\n    // Update the specific container content\n    const newContent = newDocument.querySelector(container.tagName);\n    if (newContent) {\n      container.innerHTML = newContent.innerHTML;\n    }\n\n    // Update the URL without reloading the page\n    window.history.pushState({}, \"\", href);\n\n    // Re-attach event listeners to the new content\n    setupTransition(container, options, animateFunction);\n  } catch (error) {\n    console.error(\"Failed to update DOM:\", error);\n    window.location.href = href;\n  }\n}\n\nfunction createKeyframeAnimation(animOptions: TransitionAnimation, prefix: string): { keyframes: Keyframe[] } {\n  const fromStyles = Object.entries(animOptions.from as TransitionStyles)\n    .map(([key, value]) => `${kebabCase(key)}: ${value};`)\n    .join(\" \");\n  const toStyles = Object.entries(animOptions.to as TransitionStyles)\n    .map(([key, value]) => `${kebabCase(key)}: ${value};`)\n    .join(\" \");\n\n  return {\n    keyframes: [\n      { [prefix]: \"0%\", ...animOptions.from },\n      { [prefix]: \"100%\", ...animOptions.to },\n    ],\n  };\n}\n","// src/utils.ts\n\nexport function applyDefaults<T extends Record<string, any>>(options: Partial<T>, defaults: T): T {\n  const result = { ...defaults };\n  for (const key in options) {\n    if (Object.prototype.hasOwnProperty.call(options, key)) {\n      const value = options[key];\n      if (typeof value === 'object' && value !== null && key in result) {\n        result[key] = applyDefaults(\n          value as Partial<T[Extract<keyof T, string>]>,\n          result[key] as T[Extract<keyof T, string>]\n        );\n      } else {\n        result[key] = value as T[Extract<keyof T, string>];\n      }\n    }\n  }\n  return result;\n}\n\nexport function kebabCase(str: string): string {\n  return str.replace(/[A-Z]/g, letter => `-${letter.toLowerCase()}`);\n}"],"names":[],"version":3,"file":"sparef.mjs.map"}